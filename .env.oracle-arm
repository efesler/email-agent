# ===================================
# Email Agent AI - Oracle ARM Configuration
# ===================================
# Optimisé pour Oracle Cloud ARM Free Tier
# 24 GB RAM, 4 OCPUs ARM Ampere A1
#
# IMPORTANT: Copier vers .env et modifier les valeurs

# ===================================
# Application
# ===================================
ENVIRONMENT=production
DEBUG=false
LOG_LEVEL=INFO

# ARM-specific
ARM_OPTIMIZED=true
PLATFORM=arm64

# ===================================
# Security Keys
# ===================================
# CHANGEZ CES VALEURS EN PRODUCTION !
SECRET_KEY=CHANGEME_GENERATE_WITH_openssl_rand_hex_32
ENCRYPTION_KEY=CHANGEME_GENERATE_WITH_python_cryptography_fernet

# Génération des clés:
# SECRET_KEY: openssl rand -hex 32
# ENCRYPTION_KEY: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"

# ===================================
# Database (PostgreSQL ARM optimisé)
# ===================================
DATABASE_URL=postgresql://emailagent:CHANGEME_DB_PASSWORD@db:5432/emailagent
DB_PASSWORD=CHANGEME_DB_PASSWORD

# Pool settings (optimisé pour 4 workers + API)
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=10
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# ===================================
# Redis (Cache + Queue)
# ===================================
REDIS_URL=redis://redis:6379/0
REDIS_PASSWORD=CHANGEME_REDIS_PASSWORD
REDIS_MAX_MEMORY=2gb
REDIS_EVICTION_POLICY=allkeys-lru

# ===================================
# Ollama LLM (ARM64 Mistral)
# ===================================
OLLAMA_HOST=http://ollama:11434
OLLAMA_MODEL=mistral
OLLAMA_TIMEOUT=150
OLLAMA_NUM_PARALLEL=2
OLLAMA_MAX_LOADED_MODELS=1
OLLAMA_KEEP_ALIVE=30m

# Fallback API (optionnel - si Ollama surchargé)
USE_ANTHROPIC_FALLBACK=false
ANTHROPIC_API_KEY=
ANTHROPIC_MODEL=claude-haiku-4-5-20251001

# ===================================
# Email Processing (optimisé pour volume)
# ===================================
EMAIL_POLL_INTERVAL=10
PROCESSING_MODE=auto
MAX_EMAIL_SIZE_MB=25

# Batch processing (optimisé pour 4 workers ARM)
EMAIL_SYNC_BATCH_SIZE=1000
CLASSIFICATION_BATCH_SIZE=100
MAX_EMAILS_PER_SYNC=2000

# Traitement progressif pour grandes inbox
ENABLE_PROGRESSIVE_SYNC=true
INITIAL_SYNC_DAYS=30
PROGRESSIVE_SYNC_DAYS=90,180,365,all

# ===================================
# Celery Workers (4 workers pour 4 cores)
# ===================================
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1
CELERY_WORKERS=4
CELERY_WORKER_CONCURRENCY=1
CELERY_WORKER_PREFETCH=2
CELERY_MAX_TASKS_PER_CHILD=1000
CELERY_TASK_TIME_LIMIT=300
CELERY_TASK_SOFT_TIME_LIMIT=270

# ===================================
# Classification (hybride pour performance)
# ===================================
USE_BATCH_CLASSIFICATION=true
CLASSIFICATION_STRATEGY=hybrid
CLASSIFICATION_CONFIDENCE_THRESHOLD=85

# Ratio règles vs IA (optimisé pour vitesse)
RULES_FIRST=true
SKIP_AI_FOR_HIGH_CONFIDENCE=true
AI_ONLY_FOR_UNCERTAIN=true

# ===================================
# Admin
# ===================================
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=CHANGEME_ADMIN_PASSWORD

# ===================================
# OAuth Providers (optionnel)
# ===================================
# Gmail OAuth2
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://your-domain.com/auth/google/callback

# Microsoft OAuth2
MICROSOFT_CLIENT_ID=
MICROSOFT_CLIENT_SECRET=
MICROSOFT_REDIRECT_URI=http://your-domain.com/auth/microsoft/callback

# ===================================
# Monitoring & Logging
# ===================================
SENTRY_DSN=
PROMETHEUS_ENABLED=false

# Log retention
LOG_RETENTION_DAYS=30
LOG_MAX_SIZE_MB=100

# ===================================
# Backup
# ===================================
BACKUP_DIR=/var/backups/email-agent
BACKUP_RETENTION_DAYS=30
AUTO_BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 3 * * *

# ===================================
# Performance Tuning ARM
# ===================================
# Resource limits
MAX_CONCURRENT_CLASSIFICATIONS=4
MAX_CONCURRENT_SYNCS=2

# Timeouts (ARM légèrement plus lent)
HTTP_TIMEOUT=60
IMAP_TIMEOUT=90
CLASSIFICATION_TIMEOUT=150

# Rate limiting
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# ===================================
# Security
# ===================================
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
REFRESH_TOKEN_EXPIRE_DAYS=30

CORS_ORIGINS=http://localhost:3000,https://your-domain.com
ALLOWED_HOSTS=localhost,127.0.0.1,your-domain.com

# ===================================
# Oracle Cloud Specific
# ===================================
CLOUD_PROVIDER=oracle
INSTANCE_TYPE=ampere-a1
REGION=eu-paris-1

# Network
MTU_SIZE=1500
USE_IPV6=false

# Storage
DATA_DIR=/app/data
LOGS_DIR=/app/logs
TEMP_DIR=/tmp

# ===================================
# Feature Flags
# ===================================
ENABLE_EMAIL_SYNC=true
ENABLE_CLASSIFICATION=true
ENABLE_AUTO_ACTIONS=true
ENABLE_QUARANTINE=true
ENABLE_EMAIL_PREVIEW=true

# ===================================
# NOTES
# ===================================
# 1. Changez TOUS les "CHANGEME" avant déploiement
# 2. Utilisez des mots de passe forts (32+ caractères)
# 3. Sauvegardez ce fichier de manière sécurisée
# 4. Ne committez JAMAIS .env dans Git
# 5. Vérifiez les permissions: chmod 600 .env
